# Server
server.port=8080

# PostgreSQL
spring.datasource.url=jdbc:postgresql://localhost:5432/movieapp
spring.datasource.username=postgres
spring.datasource.password=postgres
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# App
spring.application.name=movie-booking-monolith

# SECURITY - DISABLE EVERYTHING
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,\
org.springframework.boot.actuate.autoconfigure.security.servlet.ManagementWebSecurityAutoConfiguration

## NO ACTUATOR SECURITY
#management.security.enabled=false
#management.endpoints.web.exposure.include=health,info
#management.endpoint.health.show-details=always
management.endpoint.health.roles=*

# Logging
logging.level.com.moviebooking=DEBUG

spring.jackson.mapper.accept-case-insensitive-enums=true

# JWT
jwt.secret=abcdefghijklmnopqrstuvwxyzabcdefghijkl
jwt.expiration-ms=86400000
# 24 hours

# Resilience4j Circuit Breaker (paymentGateway instance)
resilience4j.circuitbreaker.instances.paymentGateway.register-health-indicator=true
resilience4j.circuitbreaker.instances.paymentGateway.sliding-window-size=10
resilience4j.circuitbreaker.instances.paymentGateway.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.paymentGateway.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.paymentGateway.permitted-number-of-calls-in-half-open-state=3

# Retry (paymentInit instance)
resilience4j.retry.instances.paymentInit.enable-exponential-backoff=true
resilience4j.retry.instances.paymentInit.exponential-backoff-multiplier=2.0
resilience4j.retry.instances.paymentInit.max-attempts=4
resilience4j.retry.instances.paymentInit.wait-duration=100ms
resilience4j.retry.instances.paymentInit.retry-exceptions=java.net.ConnectException,org.springframework.web.client.ResourceAccessException

# Rate Limiter (paymentCallback instance)
resilience4j.ratelimiter.instances.paymentCallback.limit-for-period=100
resilience4j.ratelimiter.instances.paymentCallback.limit-refresh-period=1m
resilience4j.ratelimiter.instances.paymentCallback.timeout-duration=1s

# ========================================
# Day 17: Rate Limiting (100 req/min per IP)
# ========================================
resilience4j.ratelimiter.instances.paymentInit.limit-for-period=100
resilience4j.ratelimiter.instances.paymentInit.limit-refresh-period=1m
resilience4j.ratelimiter.instances.paymentInit.timeout-duration=1s

# Day 18 - Bulkhead (Semaphore) for /api/payments/init
resilience4j.bulkhead.instances.paymentInit.max-concurrent-calls=10
resilience4j.bulkhead.instances.paymentInit.max-wait-duration=0

# ========================================
# Actuator + Resilience4j Metrics (Day 9)
# ========================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus,circuitbreakers
management.endpoint.health.show-details=always
management.prometheus.metrics.export.enabled=true
management.metrics.tags.application=movie-booking-monolith


# Kafka (localhost:9092 from Docker)
spring.kafka.bootstrap-servers=localhost:9092
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer
spring.kafka.producer.acks=all
spring.kafka.producer.properties.enable.idempotence=true


# Kafka Consumer - FIXED
spring.kafka.consumer.group-id=movie-notifications
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer
spring.kafka.consumer.properties.spring.json.trusted.packages=com.moviebooking.movie_booking_monolith.dto.event.*
spring.kafka.consumer.properties.spring.json.value.default.type=com.moviebooking.movie_booking_monolith.dto.event.BookingEvent

# ===== REDIS/REDISSON (Day 12) =====
spring.redis.host=127.0.0.1
spring.redis.port=6379
spring.redis.password=movie123
spring.redis.database=0

# Redisson properties (forces AUTH before PING)
spring.redisson.address=redis://127.0.0.1:6379
spring.redisson.password=movie123
spring.redisson.database=0
spring.redisson.timeout=5000
spring.redisson.retry-attempts=3
spring.redisson.retry-interval=1500
spring.redisson.connection-minimum-idle-size=10
spring.redisson.connection-pool-size=64

management.health.redis.enabled=false

# ===== CACHING (Day 14) =====
spring.cache.type=redis
spring.cache.redis.time-to-live=600000
spring.cache.redis.use-key-prefix=true
spring.cache.redis.cache-null-values=false

# NEW: Extract client IP for per-user limiting
spring.cloud.loadbalancer.retry.enabled=false
management.metrics.web.client.max-in-memory-size=100mb

# Register rate limiter for health checks + metrics
resilience4j.ratelimiter.instances.paymentInit.register-health-indicator=true






